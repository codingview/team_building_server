!function(t){function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}var e={};n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},n.p="",n(n.s=20)}({0:function(t,n,e){"use strict";t.exports=function(t){return new Promise(function(n,e){var o="text"in t?t.text:"";$.ajax({url:t.url,type:"type"in t?t.type:"post",data:"data"in t?t.data:{},dataType:"json",success:function(t){t&&"status"in t&&t.status>0?n(t.data):e("message"in t?t.message:o+"出错")},error:function(t){console.error(t),e(o+"超时")}})})}},2:function(t,n,e){"use strict";t.exports=["head","bold","italic","underline","strikeThrough","foreColor","backColor","link","list","justify","quote","emoticon","image","table","code","undo","redo"]},20:function(t,n,e){"use strict";var o=e(4),i=o.editor,r={setOneSubmit:function(){$("#p_submit").one("click",function(){var t=o.Dom.getForm();if(t.rich_text=i.txt.html(),t.text=i.txt.text(),t.sequence=t.top?0:99,t.img=parseInt($("#p_icon_val").val()),0===t.img)return r.setOneSubmit(),alert("请上传缩略图"),!1;delete t.top,t.name?o.Data.add(t).then(function(){location.href="/admin/production/list"}).catch(function(t){alert(t)}):alert("请输入产品名称"),r.setOneSubmit()})},init:function(){this.setOneSubmit()}};$(function(){r.init(),i=o.Dom.editor(),o.Listener.reset(i)})},4:function(t,n,e){"use strict";var o=void 0,i=e(0),r=window.wangEditor,a={add:function(t){return i({url:"/admin/production/add",type:"put",data:t,message:"新增产品"})},update:function(t){return i({url:"/admin/production/update",type:"put",data:t,message:"更新产品"})},catalogs:function(){return new Promise(function(t,n){return $.ajax({url:"/admin/production/catalog/list",type:"get",dataType:"json",success:function(e){e&&"status"in e&&e.status>0?t(e.data):n("message"in e?e.message:"获取分类列表出错")},error:function(t){console.error(t),n("获取分类列表超时")}})})}},c={setCatalogs:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"list",e="",o=parseInt($("#p_sci_val").val()),i=function(t){return t.id===o?"selected":""};return t.forEach(function(t){"list"===n||(e+='<optgroup label=" '+t.name+'">'),"second"in t&&Array.isArray(t.second)&&t.second.length>0&&t.second.forEach(function(n){e+='<option value="'+n.id+'" '+i(n)+' data-fci="'+t.id+'" data-sci="'+n.id+'"> >> '+n.name+"</option>"}),"list"!==n&&(e+="</optgroup>")}),e},setCatalogsKv:function(t){var n={};return t.forEach(function(t){t.second&&t.second.forEach(function(t){n[t.id]=t.name})}),n},editor:function(){return o=new r("#p_editor"),o.customConfig.menus=e(2),o.customConfig.uploadImgShowBase64=!0,o.customConfig.uploadImgMaxLength=5,o.customConfig.pasteFilterStyle=!1,o.create(),o},catalogs:function(){return a.catalogs().then(function(t){$("#p_sci").html(c.setCatalogs(t,"add"))}).catch(function(t){console.error(t),alert("获取分类列表出错")})},getForm:function(){for(var t={},n=$("#p_form"),e=n.find("input,select"),o=0,i=e.length;o<i;o++){var r=e.eq(o),a=r.attr("id").replace(/p_/g,"");"text"===a||("top"===a?t.top=r.is(":checked"):t[a]=r.val())}return t.fci=$("#p_sci").find('[data-sci="'+t.sci+'"]').data("fci"),t.abstract=$("#p_abstract").val(),t},init:function(){this.catalogs()}},s={reset:function(t){$("#p_reset").on("click",function(){t.txt.clear()})}};$(function(){$("#p_sci").length>0&&c.init(),e(5)()}),t.exports={Data:a,Dom:c,Listener:s,editor:o}},5:function(t,n,e){"use strict";var o={ajax:function(){return new Promise(function(t,n){return $.ajax({url:"/admin/production/image",type:"put",data:o.getForm(),dataType:"json",processData:!1,contentType:!1,success:function(e){e&&"status"in e&&e.status>0?t(e.data):n("message"in e?e.message:"上传图片出错")},error:function(t){console.error(t),n("上传图片超时")}})})},getForm:function(){var t=new FormData;return t.append("img",$("#p_icon").get(0).files[0]),t},init:function(){$("#p_icon").on("change",function(){o.ajax().then(function(){$("#p_icon_val").val(1)}).catch(function(t){return alert(t)})})}};t.exports=o.init}});