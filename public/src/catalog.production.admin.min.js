!function(n){function e(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return n[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var t={};e.m=n,e.c=t,e.d=function(n,t,r){e.o(n,t)||Object.defineProperty(n,t,{configurable:!1,enumerable:!0,get:r})},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},e.p="",e(e.s=20)}({20:function(n,e,t){"use strict";function r(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function n(e){r(this,n),this.id=e.id,this.name=e.name,this.father_id=e.father_id,this.grade=e.grade,this.sequence=e.sequence},a=void 0,i={catalogs:t(6).catalogs,rename:function(n){return new Promise(function(e,t){return $.ajax({url:"/admin/production/catalog",type:"post",data:n,dataType:"json",success:function(n){n&&"status"in n&&n.status>0?e():t("message"in n?n.message:"修改分类名称出错")},error:function(n){console.error(n),t("修改分类名称超时")}})})},add:function(n){return new Promise(function(e,t){return $.ajax({url:"/admin/production/catalog",type:"put",data:n,dataType:"json",success:function(n){n&&"status"in n&&n.status>0?e(n.data):t("message"in n?n.message:"新增分类出错")},error:function(n){console.error(n),t("新增分类名称超时")}})})},remove:function(n){return new Promise(function(e,t){return $.ajax({url:"/admin/production/catalog",type:"delete",data:{cid:n},dataType:"json",success:function(n){n&&"status"in n&&n.status>0?e():t("message"in n?n.message:"新增分类出错")},error:function(n){console.error(n),t("新增分类名称超时")}})})}},c={addHoverDom:function(n,e){var t=$("#"+e.tId+"_span"),r="#addBtn_"+e.tId,o=$(r);if(e.editNameFlag||o.length>0||3===e.grade)return!1;var c='<span class="button add" id="addBtn_'+e.tId+'" title="增加" onfocus="this.blur();"></span>';t.after(c);var u=$(r);u&&u.bind("click",function(){console.info(e);var n={name:"新的分类",grade:e.level+1,father_id:e.id,sequence:e.children?e.children.length:0,icon:""};return i.add(n).then(function(n){return a.addNodes(e,{id:n.id,pId:e.id,name:"新的分类"})}).catch(function(n){alert(n)}),!1})},removeHoverDom:function(n,e){return $("#addBtn_"+e.tId).unbind().remove()},catalogs:function(){i.catalogs().then(function(n){return a=$.fn.zTree.init($("#production_catalog"),{view:{addHoverDom:c.addHoverDom,removeHoverDom:c.removeHoverDom,selectedMulti:!1},edit:{enable:!0,removeTitle:"删除",renameTitle:"重命名",showRenameBtn:function(n,e){return!e.noEditBtn},showRemoveBtn:function(n,e){return!e.noEditBtn}},callback:{onNodeCreated:function(n,e,t){},beforeRemove:function(n,e){if(e.children&&e.children.length>0)return alert("该分类下有子分类"),!1;i.remove(e.id).then().catch(function(n){return alert(n)})},onRename:function(n,e,t,r){if(!t.name)return alert("请填写分类名称"),!1;i.rename(new o(t)).then().catch(function(n){return alert(n)})}}},[{name:"产品分类",id:0,open:!0,children:n,noEditBtn:!0}])}).catch(function(n){return alert(n)})},init:function(){this.catalogs()}},u={init:function(){}};$(function(){c.init(),u.init()})},6:function(n,e,t){"use strict";n.exports={catalogs:function(){return new Promise(function(n,e){return $.ajax({url:"/admin/production/catalog/list",type:"get",dataType:"json",success:function(t){t&&"status"in t&&t.status>0?n(t.data):e("message"in t?t.message:"获取分类列表出错")},error:function(n){console.error(n),e("获取分类列表超时")}})})},setCatalogs:function(n){var e="",t=parseInt($("#p_catalog_id_val").val());return n.forEach(function(n){e+='<optgroup label="'+n.name+'">',"children"in n&&n.children instanceof Array&&n.children.length>0&&n.children.forEach(function(n){e+='<option value="'+n.id+'" '+(n.id===t?"selected":"")+">"+n.name+"</option>"}),e+="</optgroup>"}),e},setCatalogsKv:function(n){var e={};return n.forEach(function(n){e[n.id]=n.name,n.children&&n.children.forEach(function(n){e[n.id]=n.name})}),e}}}});