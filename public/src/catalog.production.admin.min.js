!function(t){function n(o){if(e[o])return e[o].exports;var a=e[o]={i:o,l:!1,exports:{}};return t[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}var e={};n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},n.p="",n(n.s=20)}({0:function(t,n,e){"use strict";t.exports=function(t){return new Promise(function(n,e){var o="text"in t?t.text:"";$.ajax({url:t.url,type:"type"in t?t.type:"post",data:"data"in t?t.data:{},dataType:"json",success:function(t){t&&"status"in t&&t.status>0?n(t.data):e("message"in t?t.message:o+"出错")},error:function(t){console.error(t),e(o+"超时")}})})}},1:function(t,n,e){"use strict";t.exports=["head","bold","italic","underline","strikeThrough","foreColor","backColor","link","list","justify","quote","emoticon","image","table","code","undo","redo"]},2:function(t,n,e){"use strict";var o=void 0,a=e(0),r=window.wangEditor,i={add:function(t){return a({url:"/admin/production/add",type:"put",data:t,message:"新增产品"})},update:function(t){return a({url:"/admin/production/update",type:"put",data:t,message:"更新产品"})},catalogs:function(){return new Promise(function(t,n){return $.ajax({url:"/admin/production/catalog/list",type:"get",dataType:"json",success:function(e){e&&"status"in e&&e.status>0?t(e.data):n("message"in e?e.message:"获取分类列表出错")},error:function(t){console.error(t),n("获取分类列表超时")}})})}},c={setCatalogs:function(t){var n="",e=parseInt($("#p_catalog_id_val").val());return t.forEach(function(t){n+='<optgroup label="'+t.name+'">',"children"in t&&t.children instanceof Array&&t.children.length>0&&t.children.forEach(function(t){n+='<option value="'+t.id+'" '+(t.id===e?"selected":"")+">"+t.name+"</option>"}),n+="</optgroup>"}),n},setCatalogsKv:function(t){var n={};return t.forEach(function(t){n[t.id]=t.name,t.children&&t.children.forEach(function(t){n[t.id]=t.name})}),n},editor:function(){return o=new r("#p_editor"),o.customConfig.menus=e(1),o.customConfig.uploadImgShowBase64=!0,o.customConfig.uploadImgMaxLength=5,o.customConfig.pasteFilterStyle=!1,o.create(),o},catalogs:function(){return i.catalogs().then(function(t){return $("#p_catalog_id").html(c.setCatalogs(t))}).catch(function(t){console.error(t),alert("获取分类列表出错")})},getForm:function(){for(var t={},n=$("#p_form"),e=n.find("input,select"),o=0,a=e.length;o<a;o++){var r=e.eq(o),i=r.attr("id").replace(/p_/g,"");"text"===i||("top"===i?t.top=r.is(":checked"):t[i]=r.val())}return t.abstract=$("#p_abstract").val(),t},init:function(){this.catalogs()}},u={reset:function(t){$("#p_reset").on("click",function(){t.txt.clear()})}};$(function(){c.init(),e(3)()}),t.exports={Data:i,Dom:c,Listener:u,editor:o}},20:function(t,n,e){"use strict";function o(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var a=e(0),r=function t(n){o(this,t),this.id=n.id,this.name=n.name,this.father_id=n.father_id,this.grade=n.grade,this.sequence=n.sequence},i=void 0,c={catalogs:e(2).Data.catalogs,rename:function(t){return a({url:"/admin/production/catalog",type:"post",data:t,message:"修改分类名称"})},add:function(t){return a({url:"/admin/production/catalog",type:"put",data:t,message:"新增分类名称"})},remove:function(t){return a({url:"/admin/production/catalog",type:"delete",data:{cid:t},message:"删除分类"})}},u={addHoverDom:function(t,n){var e=$("#"+n.tId+"_span"),o="#addBtn_"+n.tId,a=$(o);if(n.editNameFlag||a.length>0||3===n.grade)return!1;var r='<span class="button add" id="addBtn_'+n.tId+'" title="增加" onfocus="this.blur();"></span>';e.after(r);var u=$(o);u&&u.bind("click",function(){console.info(n);var t={name:"新的分类",grade:n.level+1,father_id:n.id,sequence:n.children?n.children.length:0,icon:""};return c.add(t).then(function(t){return i.addNodes(n,{id:t.id,pId:n.id,name:"新的分类"})}).catch(function(t){alert(t)}),!1})},removeHoverDom:function(t,n){return $("#addBtn_"+n.tId).unbind().remove()},catalogs:function(){c.catalogs().then(function(t){return i=$.fn.zTree.init($("#production_catalog"),{view:{addHoverDom:u.addHoverDom,removeHoverDom:u.removeHoverDom,selectedMulti:!1},edit:{enable:!0,removeTitle:"删除",renameTitle:"重命名",showRenameBtn:function(t,n){return!n.noEditBtn},showRemoveBtn:function(t,n){return!n.noEditBtn}},callback:{onNodeCreated:function(t,n,e){},beforeRemove:function(t,n){if(n.children&&n.children.length>0)return alert("该分类下有子分类"),!1;c.remove(n.id).then().catch(function(t){return alert(t)})},onRename:function(t,n,e,o){if(!e.name)return alert("请填写分类名称"),!1;c.rename(new r(e)).then().catch(function(t){return alert(t)})}}},[{name:"产品分类",id:0,open:!0,children:t,noEditBtn:!0}])}).catch(function(t){return alert(t)})},init:function(){this.catalogs()}},s={init:function(){}};$(function(){u.init(),s.init()})},3:function(t,n,e){"use strict";var o={ajax:function(){return new Promise(function(t,n){return $.ajax({url:"/admin/production/image",type:"put",data:o.getForm(),dataType:"json",processData:!1,contentType:!1,success:function(e){e&&"status"in e&&e.status>0?t(e.data):n("message"in e?e.message:"上传图片出错")},error:function(t){console.error(t),n("上传图片超时")}})})},getForm:function(){var t=new FormData;return t.append("img",$("#p_icon").get(0).files[0]),t},init:function(){$("#p_icon").on("change",function(){o.ajax().then(function(){$("#p_icon_val").val(1)}).catch(function(t){return alert(t)})})}};t.exports=o.init}});